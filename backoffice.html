<!DOCTYPE html>
<html lang="fr">
<head>
    <meta charset="UTF-8">
    <title>Backoffice Google Analytics</title>
</head>
<body>
    <h2>Connexion Google Analytics</h2>
    <button onclick="handleAuthClick()">Se connecter</button>
    <div id="analytics-results"></div>

    <script src="https://apis.google.com/js/api.js"></script>
    <script>
        const CLIENT_ID = "1054909091457-1m5o2g3mlvknu2m5n7shuu8m43cdelc4.apps.googleusercontent.com";
        const API_KEY = "AIzaSyAUUUcIG1TRzCP3MjKUNvoSiFGK4KkStbo";
        const VIEW_ID = "G-P2DKDZRQ47";
        const SCOPES = "https://www.googleapis.com/auth/analytics.readonly";

        function initClient() {
            gapi.client.init({
                apiKey: API_KEY,
                clientId: CLIENT_ID,
                discoveryDocs: ["https://analyticsreporting.googleapis.com/$discovery/rest?version=v4"],
                scope: SCOPES
            }).then(() => {
                console.log("Google API chargÃ©e.");
            }).catch(error => {
                console.error("Erreur d'initialisation:", error);
            });
        }

        function handleAuthClick() {
            gapi.auth2.getAuthInstance().signIn().then(getAnalyticsData);
        }

        function getAnalyticsData() {
            gapi.client.analyticsreporting.reports.batchGet({
                reportRequests: [{
                    viewId: VIEW_ID,
                    dateRanges: [{ startDate: "30daysAgo", endDate: "today" }],
                    metrics: [{ expression: "ga:sessions" }]
                }]
            }).then(response => {
                document.getElementById("analytics-results").innerText = JSON.stringify(response.result, null, 2);
            }).catch(error => {
                console.error("Erreur API:", error);
            });
        }

        gapi.load("client:auth2", initClient);
    </script>
</body>
</html>
